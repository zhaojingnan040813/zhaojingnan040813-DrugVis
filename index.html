<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¯ç‰©ç›¸äº’ä½œç”¨å¯è§†åŒ–æŸ¥è¯¢ç³»ç»Ÿ - äº§å“åŸå‹</title>
    <!-- å¼•å…¥ Tailwind CSS ç”¨äºå¿«é€Ÿå¸ƒå±€ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ AntV G6 ç”¨äºå›¾è°±å¯è§†åŒ– -->
    <script src="https://gw.alipayobjects.com/os/lib/antv/g6/4.8.24/dist/g6.min.js"></script>
    <!-- å¼•å…¥ FontAwesome ç”¨äºå›¾æ ‡ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3f4f6;
        }

        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
            font-weight: 600;

        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        #mountNode canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        @media (max-width: 640px) {
            .tab-active {
                font-size: 14px;
            }

            .flex {
                flex-direction: column;
            }

            .w-1/3,
            .w-2/3 {
                width: 100%;
            }

            #mountNode {
                height: 300px;
                /* é™åˆ¶å›¾è°±é«˜åº¦ */
            }
        }
    </style>
</head>

<body class="h-screen flex flex-col overflow-hidden">

    <!-- 1. é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="bg-white shadow-sm z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <i class="fa-solid fa-capsules text-blue-600 text-2xl mr-3"></i>
                    <span class="font-bold text-xl text-gray-800">DrugVis <span
                            class="text-xs text-gray-500 font-normal ml-2">è¯ç‰©ç›¸äº’ä½œç”¨ç§‘æ™®å¹³å°</span></span>
                </div>
                <div class="flex space-x-8">
                    <button onclick="switchTab('checker')" id="tab-checker"
                        class="tab-active inline-flex items-center px-1 pt-1 text-sm text-gray-900 focus:outline-none transition">
                        <i class="fa-solid fa-shield-virus mr-2"></i> å†²çªæ£€æµ‹å°
                    </button>
                    <button onclick="switchTab('graph')" id="tab-graph"
                        class="inline-flex items-center px-1 pt-1 text-sm text-gray-500 hover:text-gray-700 focus:outline-none transition">
                        <i class="fa-solid fa-project-diagram mr-2"></i> çŸ¥è¯†å›¾è°±
                    </button>
                </div>
                <div class="flex items-center">
                    <span class="text-sm text-gray-500 mr-4">æ¬¢è¿ï¼Œç”¨æˆ·</span>
                    <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                        <i class="fa-solid fa-user"></i>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 2. ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="flex-1 relative">

        <!-- è§†å›¾ A: å†²çªæ£€æµ‹å° -->
        <div id="view-checker"
            class="absolute inset-0 p-6 flex gap-6 max-w-7xl mx-auto w-full transition-opacity duration-300">

            <!-- å·¦ä¾§ï¼šæ“ä½œé¢æ¿ -->
            <div class="w-1/3 flex flex-col gap-4">
                <!-- æœç´¢æ·»åŠ  -->
                <div class="bg-white rounded-xl shadow-sm p-5 flex-none">
                    <h3 class="text-sm font-semibold text-gray-500 mb-3 uppercase tracking-wider">æ·»åŠ è¯ç‰©</h3>
                    <div class="relative">
                        <input type="text" id="drug-search" placeholder="è¾“å…¥è¯å (å¦‚: å¤´å­¢, é…’ç²¾...)"
                            class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                            onkeyup="handleSearch(event)">
                        <i class="fa-solid fa-search absolute left-3 top-3 text-gray-400"></i>

                        <!-- æ¨¡æ‹Ÿæœç´¢ä¸‹æ‹‰ç»“æœ -->
                        <div id="search-dropdown"
                            class="hidden absolute w-full bg-white border border-gray-100 shadow-lg rounded-lg mt-1 z-20 max-h-48 overflow-y-auto">
                            <!-- åŠ¨æ€å¡«å…… -->
                        </div>
                    </div>
                    <div class="mt-2 text-xs text-gray-400">
                        è¯•è¯•æœç´¢: "å¤´å­¢", "é˜¿å¸åŒ¹æ—", "é…’ç²¾", "å¸ƒæ´›èŠ¬"
                    </div>
                </div>

                <!-- è¯ç‰©æ¸…å• (è´­ç‰©è½¦) -->
                <div class="bg-white rounded-xl shadow-sm p-5 flex-1 flex flex-col min-h-0">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">å½“å‰æ¸…å• <span
                                id="cart-count"
                                class="bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded-full ml-1">0</span></h3>
                        <button onclick="clearCart()" class="text-xs text-red-400 hover:text-red-600">æ¸…ç©º</button>
                    </div>

                    <div id="drug-cart" class="flex-1 overflow-y-auto space-y-2 pr-1">
                        <!-- ç©ºçŠ¶æ€ -->
                        <div id="cart-empty"
                            class="h-full flex flex-col items-center justify-center text-gray-400 border-2 border-dashed border-gray-100 rounded-lg">
                            <i class="fa-solid fa-basket-shopping text-3xl mb-2 opacity-50"></i>
                            <p class="text-sm">æ¸…å•æ˜¯ç©ºçš„</p>
                        </div>
                    </div>

                    <button onclick="analyzeInteractions()"
                        class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 rounded-lg shadow-lg shadow-blue-500/30 transition transform active:scale-95 flex items-center justify-center">
                        <i class="fa-solid fa-flask mr-2"></i> å¼€å§‹åˆ†æå†²çª
                    </button>
                </div>
            </div>

            <!-- å³ä¾§ï¼šæ£€æµ‹æŠ¥å‘Š -->
            <div class="w-2/3 bg-white rounded-xl shadow-sm p-6 flex flex-col relative overflow-hidden">
                <div class="border-b border-gray-100 pb-4 mb-4 flex justify-between items-end">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">æ£€æµ‹æŠ¥å‘Š</h2>
                        <p class="text-sm text-gray-500 mt-1" id="report-status">è¯·åœ¨å·¦ä¾§æ·»åŠ è¯ç‰©å¹¶ç‚¹å‡»åˆ†æ...</p>
                    </div>
                    <div id="risk-badge"
                        class="hidden px-3 py-1 rounded-full text-sm font-bold bg-green-100 text-green-700">
                        <i class="fa-solid fa-check-circle mr-1"></i> å®‰å…¨
                    </div>
                </div>

                <div id="report-content" class="flex-1 overflow-y-auto pr-2">
                    <!-- é»˜è®¤æ’å›¾ -->
                    <div class="h-full flex flex-col items-center justify-center opacity-60">
                        <img src="https://cdn-icons-png.flaticon.com/512/2854/2854271.png" width="120" alt="Analysis"
                            class="mb-6 opacity-50 grayscale">
                        <p class="text-gray-400 text-lg">ç­‰å¾…æ•°æ®è¾“å…¥...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- è§†å›¾ B: çŸ¥è¯†å›¾è°± -->
        <div id="view-graph" class="absolute inset-0 hidden flex flex-col">
            <!-- å·¥å…·æ  -->
            <div class="h-14 bg-white border-b border-gray-200 px-6 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <span class="text-gray-500 text-sm">å½“å‰ä¸­å¿ƒ:</span>
                    <span class="font-bold text-gray-800 bg-gray-100 px-3 py-1 rounded-md">é˜¿å¸åŒ¹æ— (Aspirin)</span>
                    <button class="text-blue-500 text-sm hover:underline" onclick="randomizeGraph()">
                        <i class="fa-solid fa-shuffle mr-1"></i> éšæœºåˆ‡æ¢
                    </button>
                </div>
                <div class="flex items-center space-x-4 text-xs">
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-red-500 mr-2"></span> ç¦æ­¢æ··ç”¨</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-orange-400 mr-2"></span> æ…é‡ä½¿ç”¨
                    </div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-blue-300 mr-2"></span> å®‰å…¨å…³è”
                    </div>
                </div>
            </div>

            <!-- G6 å®¹å™¨ -->
            <div class="flex-1 relative bg-slate-50">
                <div id="mountNode" class="w-full h-full"></div>

                <!-- æ‚¬æµ®è¯¦æƒ…å¡ç‰‡ (æ¨¡æ‹Ÿ) -->
                <div id="graph-tooltip"
                    class="absolute top-4 right-4 w-64 bg-white p-4 rounded-lg shadow-xl border border-gray-100 hidden">
                    <h4 class="font-bold text-gray-800 border-b pb-2 mb-2">èŠ‚ç‚¹è¯¦æƒ…</h4>
                    <div class="space-y-2 text-sm">
                        <p class="text-gray-500">åç§°: <span class="text-gray-800 font-medium" id="tooltip-name">--</span>
                        </p>
                        <p class="text-gray-500">åˆ†ç±»: <span class="text-gray-800" id="tooltip-category">--</span></p>
                        <p class="text-gray-500 mt-2 text-xs leading-relaxed" id="tooltip-desc">--</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- JS é€»è¾‘ -->
    <script>
        // --- æ¨¡æ‹Ÿæ•°æ® ---
        const MOCK_DB = [
            { id: 1, name: 'å¤´å­¢æ‹‰å®š', category: 'æŠ—ç”Ÿç´ ', icon: 'ğŸ’Š' },
            { id: 2, name: 'é˜¿å¸åŒ¹æ—', category: 'è§£çƒ­é•‡ç—›', icon: 'ğŸ’Š' },
            { id: 3, name: 'å¸ƒæ´›èŠ¬', category: 'è§£çƒ­é•‡ç—›', icon: 'ğŸ’Š' },
            { id: 4, name: 'åæ³•æ—', category: 'æŠ—å‡è¡€', icon: 'ğŸ©¸' },
            { id: 5, name: 'é…’ç²¾ (ä¹™é†‡)', category: 'é£Ÿå“/é¥®å“', icon: 'ğŸº' },
            { id: 6, name: 'ç¡è‹¯åœ°å¹³', category: 'é™å‹è¯', icon: 'ğŸ’Š' },
            { id: 7, name: 'è¥¿æŸš (è‘¡è„æŸš)', category: 'æ°´æœ', icon: 'ğŸŠ' },
        ];

        // æ¨¡æ‹Ÿå†²çªè§„åˆ™ (ID pairs)
        const INTERACTIONS = [
            { pair: [1, 5], level: 'danger', title: 'åŒç¡«ä»‘æ ·ååº”', desc: 'æå…¶å±é™©ï¼å¯èƒ½å¯¼è‡´é¢éƒ¨æ½®çº¢ã€å¤´ç—›ã€èƒ¸é—·ï¼Œç”šè‡³ä¼‘å…‹æ­»äº¡ã€‚' },
            { pair: [2, 4], level: 'warning', title: 'å‡ºè¡€é£é™©å¢åŠ ', desc: 'ä¸¤è€…å‡æœ‰æŠ—å‡ä½œç”¨ï¼Œåˆç”¨å¯èƒ½å¯¼è‡´ä¸¥é‡çš„å‡ºè¡€å€¾å‘ã€‚' },
            { pair: [2, 5], level: 'warning', title: 'èƒƒé»è†œæŸä¼¤', desc: 'é…’ç²¾ä¼šåŠ é‡é˜¿å¸åŒ¹æ—å¯¹èƒƒé»è†œçš„åˆºæ¿€ï¼Œå¯èƒ½å¼•å‘å‡ºè¡€ã€‚' },
            { pair: [3, 2], level: 'caution', title: 'è¯æ•ˆæ‹®æŠ—', desc: 'å¸ƒæ´›èŠ¬å¯èƒ½ä¼šå¹²æ‰°é˜¿å¸åŒ¹æ—çš„å¿ƒè¡€ç®¡ä¿æŠ¤ä½œç”¨ã€‚' },
            { pair: [6, 7], level: 'danger', title: 'ä¸¥é‡ä½è¡€å‹', desc: 'è¥¿æŸšæ±ä¼šæŠ‘åˆ¶ä»£è°¢é…¶ï¼Œå¯¼è‡´è¯ç‰©æµ“åº¦é£™å‡ï¼Œå¼•å‘ä½è¡€å‹ä¼‘å…‹ã€‚' }
        ];

        let cart = [];
        let graphInstance = null;

        // --- é¡µé¢åˆ‡æ¢é€»è¾‘ ---
        function switchTab(tab) {
            document.querySelectorAll('button[id^="tab-"]').forEach(el => {
                el.classList.remove('tab-active', 'text-gray-900');
                el.classList.add('text-gray-500');
            });
            document.getElementById(`tab-${tab}`).classList.add('tab-active', 'text-gray-900');
            document.getElementById(`tab-${tab}`).classList.remove('text-gray-500');

            if (tab === 'checker') {
                document.getElementById('view-checker').classList.remove('hidden');
                document.getElementById('view-graph').classList.add('hidden');
            } else {
                document.getElementById('view-checker').classList.add('hidden');
                document.getElementById('view-graph').classList.remove('hidden');
                if (!graphInstance) initGraph(); // æ‡’åŠ è½½å›¾è°±
            }
        }

        // --- å†²çªæ£€æµ‹å°é€»è¾‘ ---

        function handleSearch(e) {
            const val = e.target.value.trim();
            const dropdown = document.getElementById('search-dropdown');

            if (!val) {
                dropdown.classList.add('hidden');
                return;
            }

            const results = MOCK_DB.filter(d => d.name.includes(val));
            dropdown.innerHTML = '';
            dropdown.classList.remove('hidden');

            if (results.length === 0) {
                dropdown.innerHTML = '<div class="p-3 text-sm text-gray-400">æœªæ‰¾åˆ°ç›¸å…³è¯ç‰©</div>';
            } else {
                results.forEach(drug => {
                    const item = document.createElement('div');
                    item.className = 'p-3 hover:bg-gray-50 cursor-pointer flex justify-between items-center border-b border-gray-50 last:border-0';
                    item.innerHTML = `
                        <span class="text-sm text-gray-700">${drug.icon} ${drug.name}</span>
                        <span class="text-xs text-gray-400 bg-gray-100 px-2 py-0.5 rounded">${drug.category}</span>
                    `;
                    item.onclick = () => addToCart(drug);
                    dropdown.appendChild(item);
                });
            }
        }

        function addToCart(drug) {
            if (cart.find(d => d.id === drug.id)) return;
            cart.push(drug);
            renderCart();
            document.getElementById('search-dropdown').classList.add('hidden');
            document.getElementById('drug-search').value = '';
        }

        function renderCart() {
            const container = document.getElementById('drug-cart');
            const countBadge = document.getElementById('cart-count');

            countBadge.innerText = cart.length;

            if (cart.length === 0) {
                container.innerHTML = `
                    <div id="cart-empty" class="h-full flex flex-col items-center justify-center text-gray-400 border-2 border-dashed border-gray-100 rounded-lg">
                        <i class="fa-solid fa-basket-shopping text-3xl mb-2 opacity-50"></i>
                        <p class="text-sm">æ¸…å•æ˜¯ç©ºçš„</p>
                    </div>`;
                return;
            }

            container.innerHTML = '';
            cart.forEach(drug => {
                const el = document.createElement('div');
                el.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-100 group';
                el.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-xl mr-3">${drug.icon}</span>
                        <div>
                            <div class="text-sm font-medium text-gray-800">${drug.name}</div>
                            <div class="text-xs text-gray-400">${drug.category}</div>
                        </div>
                    </div>
                    <button onclick="removeFromCart(${drug.id})" class="text-gray-300 hover:text-red-500 transition opacity-0 group-hover:opacity-100">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                `;
                container.appendChild(el);
            });
        }

        function removeFromCart(id) {
            cart = cart.filter(d => d.id !== id);
            renderCart();
        }

        function clearCart() {
            cart = [];
            renderCart();
            document.getElementById('report-content').innerHTML = `
                <div class="h-full flex flex-col items-center justify-center opacity-60">
                    <img src="https://cdn-icons-png.flaticon.com/512/2854/2854271.png" width="120" alt="Analysis" class="mb-6 opacity-50 grayscale">
                    <p class="text-gray-400 text-lg">ç­‰å¾…æ•°æ®è¾“å…¥...</p>
                </div>
            `;
            document.getElementById('risk-badge').classList.add('hidden');
            document.getElementById('report-status').innerText = 'è¯·åœ¨å·¦ä¾§æ·»åŠ è¯ç‰©å¹¶ç‚¹å‡»åˆ†æ...';
        }

        function analyzeInteractions() {
            if (cart.length < 2) {
                alert("è¯·è‡³å°‘æ·»åŠ ä¸¤ç§è¯ç‰©è¿›è¡Œæ¯”å¯¹");
                return;
            }

            const container = document.getElementById('report-content');
            const status = document.getElementById('report-status');
            const badge = document.getElementById('risk-badge');

            container.innerHTML = '<div class="flex items-center justify-center h-full"><i class="fa-solid fa-circle-notch fa-spin text-4xl text-blue-500"></i></div>';

            // æ¨¡æ‹Ÿ API å»¶è¿Ÿ
            setTimeout(() => {
                let foundInteractions = [];

                // ç®€å•çš„åŒé‡å¾ªç¯æ£€æµ‹ç®—æ³•
                for (let i = 0; i < cart.length; i++) {
                    for (let j = i + 1; j < cart.length; j++) {
                        const idA = cart[i].id;
                        const idB = cart[j].id;

                        const match = INTERACTIONS.find(rule =>
                            (rule.pair.includes(idA) && rule.pair.includes(idB))
                        );

                        if (match) {
                            foundInteractions.push({
                                drugA: cart[i],
                                drugB: cart[j],
                                rule: match
                            });
                        }
                    }
                }

                renderReport(foundInteractions);
            }, 600);
        }

        function renderReport(results) {
            const container = document.getElementById('report-content');
            const status = document.getElementById('report-status');
            const badge = document.getElementById('risk-badge');

            container.innerHTML = '';
            badge.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700', 'bg-orange-100', 'text-orange-700');

            if (results.length === 0) {
                status.innerText = `åˆ†æå®Œæˆï¼š${cart.length} ç§è¯ç‰©`;
                badge.innerText = 'å®‰å…¨';
                badge.classList.add('bg-green-100', 'text-green-700');
                container.innerHTML = `
                    <div class="text-center mt-10">
                        <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-green-100 text-green-500 mb-4">
                            <i class="fa-solid fa-shield-heart text-4xl"></i>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800">æœªå‘ç°æ˜æ˜¾ç›¸äº’ä½œç”¨</h3>
                        <p class="text-gray-500 mt-2 text-sm">åŸºäºå½“å‰æ•°æ®åº“ï¼Œæ‰€é€‰ç»„åˆæš‚æ— å·²çŸ¥çš„é«˜é£é™©å†²çªã€‚</p>
                    </div>
                `;
            } else {
                status.innerText = `åˆ†æå®Œæˆï¼šå‘ç° ${results.length} å¤„æ½œåœ¨å†²çª`;
                badge.innerText = 'å­˜åœ¨é£é™©';
                badge.classList.add('bg-red-100', 'text-red-700');

                results.forEach(item => {
                    const colorClass = item.rule.level === 'danger' ? 'border-red-200 bg-red-50' : 'border-orange-200 bg-orange-50';
                    const iconClass = item.rule.level === 'danger' ? 'text-red-500' : 'text-orange-500';
                    const badgeText = item.rule.level === 'danger' ? 'ç¦æ­¢æ··ç”¨' : 'æ…é‡ä½¿ç”¨';
                    const badgeClass = item.rule.level === 'danger' ? 'bg-red-200 text-red-800' : 'bg-orange-200 text-orange-800';

                    const card = document.createElement('div');
                    card.className = `p-4 rounded-lg border ${colorClass} mb-4 relative overflow-hidden`;
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-2 relative z-10">
                            <div class="flex items-center space-x-2">
                                <span class="text-2xl">${item.drugA.icon}</span>
                                <i class="fa-solid fa-xmark text-gray-400 text-sm"></i>
                                <span class="text-2xl">${item.drugB.icon}</span>
                            </div>
                            <span class="px-2 py-0.5 rounded text-xs font-bold ${badgeClass}">${badgeText}</span>
                        </div>
                        <h4 class="font-bold text-gray-800 text-lg flex items-center">
                            <i class="fa-solid fa-triangle-exclamation ${iconClass} mr-2"></i> ${item.rule.title}
                        </h4>
                        <p class="text-sm text-gray-600 mt-1 leading-relaxed">
                            ${item.rule.desc}
                        </p>
                        <div class="mt-3 text-xs text-gray-500 flex items-center">
                            å†²çªæº: <span class="font-medium mx-1">${item.drugA.name}</span> ä¸ <span class="font-medium mx-1">${item.drugB.name}</span>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }
        }

        // --- çŸ¥è¯†å›¾è°± (AntV G6) ---

        function initGraph() {
            const container = document.getElementById('mountNode');
            const width = container.scrollWidth;
            const height = container.scrollHeight || 600;

            // æ¨¡æ‹Ÿå›¾è°±æ•°æ®
            const data = {
                nodes: [
                    { id: '1', label: 'é˜¿å¸åŒ¹æ—', comboId: 'A', style: { fill: '#3b82f6', stroke: '#2563eb' }, labelCfg: { style: { fill: '#fff' } } },
                    { id: '2', label: 'åæ³•æ—', comboId: 'A' },
                    { id: '3', label: 'é…’ç²¾', comboId: 'B' },
                    { id: '4', label: 'å¸ƒæ´›èŠ¬', comboId: 'A' },
                    { id: '5', label: 'ç”²æ°¨è¶å‘¤', comboId: 'C' },
                    { id: '6', label: 'é“¶æå¶æå–ç‰©', comboId: 'C' }
                ],
                edges: [
                    { source: '1', target: '2', label: 'å‡ºè¡€é£é™©', style: { stroke: '#f59e0b', lineWidth: 2 } },
                    { source: '1', target: '3', label: 'èƒƒå‡ºè¡€', style: { stroke: '#ef4444', lineWidth: 2 } },
                    { source: '1', target: '4', label: 'è¯æ•ˆé™ä½', style: { stroke: '#94a3b8' } },
                    { source: '2', target: '6', label: 'æŠ—å‡å¢å¼º', style: { stroke: '#f59e0b' } },
                    { source: '1', target: '5', label: 'æ¯’æ€§å¢åŠ ', style: { stroke: '#ef4444' } }
                ]
            };

            graphInstance = new G6.Graph({
                container: 'mountNode',
                width,
                height,
                modes: {
                    default: ['drag-canvas', 'zoom-canvas', 'drag-node'],
                },
                layout: {
                    type: 'force',
                    preventOverlap: true,
                    linkDistance: 150,
                    nodeStrength: -30,
                },
                defaultNode: {
                    size: 60,
                    style: {
                        fill: '#e0f2fe',
                        stroke: '#7dd3fc',
                        lineWidth: 2,
                    },
                    labelCfg: {
                        style: {
                            fill: '#0f172a',
                            fontSize: 12,
                            fontWeight: 600
                        }
                    }
                },
                defaultEdge: {
                    style: {
                        endArrow: {
                            path: G6.Arrow.triangle(),
                            fill: '#cbd5e1',
                        },
                        stroke: '#cbd5e1'
                    },
                    labelCfg: {
                        autoRotate: true,
                        style: {
                            fill: '#64748b',
                            fontSize: 10,
                            background: {
                                fill: '#ffffff',
                                padding: [2, 2, 2, 2],
                                radius: 2,
                            },
                        }
                    }
                }
            });

            graphInstance.data(data);
            graphInstance.render();

            // ç›‘å¬èŠ‚ç‚¹ç‚¹å‡»
            graphInstance.on('node:click', (e) => {
                const model = e.item.getModel();
                showTooltip(model);
            });

            // ç›‘å¬ç”»å¸ƒç‚¹å‡»éšè— tooltip
            graphInstance.on('canvas:click', () => {
                document.getElementById('graph-tooltip').classList.add('hidden');
            });

            // çª—å£ resize
            window.onresize = () => {
                if (!graphInstance || graphInstance.get('destroyed')) return;
                if (!container || !container.scrollWidth || !container.scrollHeight) return;
                graphInstance.changeSize(container.scrollWidth, container.scrollHeight);
            };
        }

        function showTooltip(model) {
            const tooltip = document.getElementById('graph-tooltip');
            document.getElementById('tooltip-name').innerText = model.label;
            document.getElementById('tooltip-category').innerText = 'æ¨¡æ‹Ÿåˆ†ç±»';
            document.getElementById('tooltip-desc').innerText = `è¿™é‡Œæ˜¾ç¤º ${model.label} çš„è¯¦ç»†è¯ç†ä½œç”¨æè¿°...`;
            tooltip.classList.remove('hidden');
        }

        function randomizeGraph() {
            if (graphInstance) {
                graphInstance.layout(); // é‡æ–°å¸ƒå±€æ¨¡æ‹Ÿåˆ·æ–°
            }
        }
    </script>
</body>

</html>